<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>Prototype of a custom scrollbar</title>
	<style type="text/css">
	/*
	 * common
	 */
	 
	html {
		box-sizing: border-box;
		font-family: sans-serif;
	}
	*, *:before, *:after {
		box-sizing: inherit;
	}
	
	fieldset {
		display: inline-block;
		border-width: 0 0 0 1px;
	}
	
	h1 small {
		color: #999;
	}

	/*
	 * #thing...
	 */
	
	#thingWrapper {
		position: relative;
		overflow: hidden;
		height: 60vh;
		width: 80vw;
		background-color: #ccc;
		border: 1px solid #ccc;
	}
	
	#thingContentWrapper {
		position: relative;
		overflow: hidden;
		height: 100%; /*calc(100% - 16px);*/
		width: calc(100% - 16px);
		border-color: #ccc;
		border-style: solid;
		border-width: 0 1px 1px 0;
	}
	
	#thingContent {
		position: relative;
		top: 0;
		min-height: 100%;
		min-width: 100%;
	}
	#thingContent span {
		display: table-row;
		height: 20px;
		font-size: 12px;
		line-height: 20px;
		white-space: nowrap;
		background-color: #eee;
	}
	#thingContent span:nth-child(even) {
		background-color: #f9f9f9;
	}
	#thingContent span:first-child,
	#thingContent span:last-child {
		background-color: rgba(0, 166, 182, 0.16);
	}
	
	#thingControl {
		margin-bottom: 1em;
	}
	
	#thingControl div {
		display: inline-block;
		margin-bottom: 0.25em;
	}
	
	</style>
	<link href="./plain-scrollbar.css" rel="stylesheet" type="text/css">
	<script src="./plain-scrollbar.js" type="application/javascript"></script>
	<style type="text/css">
	/*
	 * some .plain-scrollbar style overloading
	 */

	.plain-scrollbar.scrollbar-horizontal .slider {
		top: 4px;
		height: 8px;
		border-radius: 8px;
	}

	.plain-scrollbar .slider {
		background-color: rgba(0, 130, 145, 0);
	}

	.plain-scrollbar:hover .slider,
	.plain-scrollbar[data-visible="true"] .slider {
		background-color: rgba(0, 130, 145, 0.9);
	}
	
	</style>
</head>
<body>

<h1>PlainScrollbar <small>a simple custom scrollbar</small></h1>

<p>
PlainScrollbar instances can be horizontal or vertical.
</p>

<hr>

<div id="thing">
	<div id="thingControl">
		<fieldset class="thing-wrapper">
			<legend>vertical options</legend>
			<div>
				<label>total</label>
				<input id="totalValueInput" type="number" value="">
			</div>
			<div>
				<label>start</label>
				<input id="startValueInput" type="number" value="">
			</div>
			<div>
				<label>visible</label>
				<span id="visibleValueInput"></span>
			</div>
		</fieldset>	
	</div>

	<div id="thingWrapper">
		<div id="thingContentWrapper">
			<div id="thingContent"></div>
		</div>
		<div id="thingScrollbarVertical" class="scrollbar-wrapper" style="height: calc(100% - 17px);"></div>
		<div id="thingScrollbarHorizontal" class="scrollbar-wrapper" style="width: calc(100% - 17px);"></div>
	</div>
</div>

<script>

// IE11 polyfill from https://developer.mozilla.org/de/docs/Web/JavaScript/Reference/Global_Objects/String/repeat
if (!String.prototype.repeat) {
  String.prototype.repeat = function(count) {
    'use strict';
    if (this == null) {
      throw new TypeError('can\'t convert ' + this + ' to object');
    }
    var str = '' + this;
    count = +count;
    if (count !== count) {
      count = 0;
    }
    if (count < 0) {
      throw new RangeError('repeat count must be non-negative');
    }
    if (count === Infinity) {
      throw new RangeError('repeat count must be less than infinity');
    }
    count = Math.floor(count);
    if (str.length === 0 || count === 0) {
      return '';
    }
    // Ensuring count is a 31-bit integer allows us to heavily optimize the
    // main part. But anyway, most current (August 2014) browsers can't handle
    // strings 1 << 28 chars or longer, so:
    if (str.length * count >= 1 << 28) {
      throw new RangeError('repeat count must not overflow maximum string size');
    }
    var rpt = '';
    for (var i = 0; i < count; i++) {
      rpt += str;
    }
    return rpt;
  }
}

var thingContentWrapperElement = document.getElementById('thingContentWrapper'),
	contentElement = document.getElementById('thingContent'),
	itemSizeVertical = 0;

/**
 * using & controlling PlainScrollbar
 */

var totalValueInputElement = document.getElementById('totalValueInput'),
	startValueInputElement = document.getElementById('startValueInput'),
	visibleValueInputElement = document.getElementById('visibleValueInput');
	
totalValueInputElement.value = 100;
startValueInputElement.value = 0;

function changeNumberOfItems(total) {
	total = parseInt(total);
	var items = contentElement.getElementsByTagName('SPAN'),
		delta = total - items.length,
		iStart = items.length,
		iMax = (items.length + delta),
		i;
		
	if (delta > 0) {
		var buffer = contentElement.innerHTML;
		for (i = iStart; i < iMax; i++) {
			buffer += '<span>' + (i) + ' ' + String('~').repeat(Math.floor(Math.random() * Math.floor(125))) + '</span>';
		}
		contentElement.innerHTML = buffer;
	}
	
	if (delta < 0) {
		for (i = (iStart -1); i > (iMax -1); i--) {
			var child = items[i];
			//child.remove(); //< Does not exist in IE 11
			contentElement.removeChild(child);
		}
	}
	
	items = contentElement.getElementsByTagName('SPAN');
	if (items.length > 0) {
		var itemBoundingClentRect = items[0].getBoundingClientRect();
		itemSizeVertical = itemBoundingClentRect.height;
	} else {
		itemSizeVertical = 0;
	}
}

function determineNumberOfItems(orientation) {
	var numberOfItems = {};
	switch(orientation) {
		case 'horizontal':
			numberOfItems = {
				total: contentElement.scrollWidth,
				visible: Math.round(thingContentWrapperElement.clientWidth),
				start: 0
			};
			break;
		
		case 'vertical':
			numberOfItems = {
				total: parseInt(totalValueInputElement.value),
				visible: thingContentWrapperElement.clientHeight / itemSizeVertical,
				start: parseInt(startValueInputElement.value),
			};
			visibleValueInputElement.innerHTML = numberOfItems.visible;
			break;
	}
	return numberOfItems;
}

changeNumberOfItems(totalValueInputElement.value);

// init horizontal scrollbar
var horizontalScrollbar = new PlainScrollbar({
	scrollbarElement: document.getElementById('thingScrollbarHorizontal'),
	orientation: 'horizontal',
	alwaysVisible: false,
	// arrows: true,
	movePageByPageOnAreaClick: false,
	numberOfItems: determineNumberOfItems('horizontal'),
	wheelSpeed: 8,
	onUpdate: function(start) {
// 			console.log("horizontalScrollbar:onUpdate", start, this);
		contentElement.style['left'] = (start  * -1) + 'px';
	}
});
	
// init vertical scrollbar
var verticalScrollbar = new PlainScrollbar({
	scrollbarElement: document.getElementById('thingScrollbarVertical'),
	orientation: 'vertical',
	arrows: true,
	alwaysVisible: true,
	numberOfItems: determineNumberOfItems('vertical'),
	onUpdate: function(start) {
		// console.log("verticalScrollbar:onUpdate", start, this);
		contentElement.style['top'] = (start * -itemSizeVertical) + 'px';
		startValueInputElement.value = start;
	}
});

contentElement.addEventListener('wheel', function(event) {
// 	console.log('contentElement:wheel', event);
	event.preventDefault();
	// process event 
	var verticalData = verticalScrollbar.calculateDataFromEvent(event),
		hasVerticalChanges = (Math.floor(verticalData.value) !== 0),
		horizontalData  = horizontalScrollbar.calculateDataFromEvent(event),
		hasHorizontalChanges = (Math.floor(horizontalData.value) !== 0);
	
	if (hasVerticalChanges) {
		verticalScrollbar.setSlider(verticalData);
	}
	
	if (hasHorizontalChanges) {
		horizontalScrollbar.setSlider(horizontalData);
	}
}, false);

window.addEventListener('resize', function(event) {
// 	console.log('window:resize');
	horizontalScrollbar.setNumberOfItems(determineNumberOfItems('horizontal'));
	verticalScrollbar.setNumberOfItems(determineNumberOfItems('vertical'));
}, false);

totalValueInputElement.addEventListener('keypress', function (event) {
// 	console.log('totalValueInputElement:keypress', event);
    var key = event.which || event.keyCode;
    if (key === 13) { // 13 eq ENTER
		event.preventDefault();
		changeNumberOfItems(totalValueInputElement.value);
		verticalScrollbar.setNumberOfItems(determineNumberOfItems('vertical'));
    }
});
totalValueInputElement.addEventListener('blur', function(event) {
// 	console.log('totalValueInputElement:blur', event);
	event.preventDefault();
	changeNumberOfItems(totalValueInputElement.value);
	verticalScrollbar.setNumberOfItems(determineNumberOfItems('vertical'));
}, false);

startValueInputElement.addEventListener('keypress', function (event) {
// 	console.log('startValueInputElement:keypress', event);
    var key = event.which || event.keyCode;
    if (key === 13) { // 13 eq ENTER
		event.preventDefault();
		verticalScrollbar.setNumberOfItems(determineNumberOfItems('vertical'));
    }
});
startValueInputElement.addEventListener('blur', function(event) {
// 	console.log('startValueInputElement:blur', event);
	event.preventDefault();
	verticalScrollbar.setNumberOfItems(determineNumberOfItems('vertical'));
}, false);

</script>

</body>
</html>
